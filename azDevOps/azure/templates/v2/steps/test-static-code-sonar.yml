############################################################################################################
# desc: Performs static code analysis using code coverage from Jest unit tests and SonarCloud
# params: Working directory, container to run in
# return:
# pre-reqs: dependency installation
############################################################################################################

parameters:
  working_directory: ""
  target_container: ""
  sonar_command: "sonar-scanner"

steps:
  # SonarCloud Start
  - bash: |
      ${{ parameters.sonar_command }} -v
      ${{ parameters.sonar_command }}
    displayName: "Static Analysis: SonarScanner Run"
    target:
      container: ${{ parameters.target_container }}
    env:
      SONAR_HOST_URL: https://sonarcloud.io
      SONAR_TOKEN: $SONAR_TOKEN
      SONAR_PROJECT_KEY: $SONAR_PROJECT_KEY
      SONAR_ORGANIZATION: $SONAR_ORGANIZATION
      BUILD_NUMBER: $(Build.BuildNumber)
    workingDirectory: ${{ parameters.working_directory }}
