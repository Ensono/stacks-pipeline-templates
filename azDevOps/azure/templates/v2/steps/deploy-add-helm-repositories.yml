parameters:
  - name: pipeline_scripts_dir
    type: string
  - name: container
    type: string
    default: "host"
  - name: helm_repositories
    type: object
    default: []
steps:
  - ${{ each repository in parameters.helm_repositories }}:
      - task: PowerShell@2
        inputs:
          targetType: 'filePath'
          filePath: "${{ parameters.pipeline_scripts_dir }}/pwsh/k8s/New-HelmRepository.ps1"
          arguments: >
            -RepositoryName ${{ repository.key }}
            -RepositoryUrl ${{ repository.value }}
        target:
          container: "${{ parameters.container }}"
        displayName: "Add: Helm Repository (${{ repository.key }}: ${{ repository.value }})"
